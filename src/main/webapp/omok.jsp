<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>Insert title here</title>
    <link rel="stylesheet" href="./omok.css">
    <link rel="stylesheet" href="./reset.css">
</head>
<body>

 <div class="realwrap">
        
    <div class="wrap">
        
        
        <div class="pan">
           <!--  <img class="sinsun" src="./img/sinsun.png"> -->
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
          
            </ul>
        </div>
        <div class="pan">
            <ul class="x">
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
                <li ><img src=""></li>
            </ul>
        </div>

        <div class="itembox">
            <img class = "panimg" src="./img/pan5.png">
            <div id = "blurblack">  </div>
            <div id = "blackwin"><img src="./img/blackwin.png"></div>
            <div id = "whitewin"><img src="./img/whitewin.png"></div>
            </div>
            <img class="paper" src="./img/pate.png"> 
            <img class="pen" src="./img/pen.png"> 
            <img id = "turndoll" src="./img/black.png">
        </div>
        <img class = "panshadow" src="./img/realshadow.png">
       
</div>
    <script>
        var x;
        var y;
        var arr = new Array(19);
        var turn = 1;
        var whowin = "none"
		//pan행렬 생성 19*19
        for (var i = 0; i < arr.length; i++) {
            arr[i] = new Array(19);
        }
        var pans = document.querySelectorAll(".x");
        // arr 인덱스로 값뽀ㅃ으면 object라 Number() 로 형변환 필
        
        //승리판단
        function iswin() {
            var cnt = 0;//각 for문 마다 연속돌 새는거
            var flag = turn == 1? "black" : "white";

            //garo
            for(var i = 0; i < 19; i++) {
                if (Number(arr[x][i]) == turn) {
                    cnt += 1;
                    if (cnt >= 5) {
                        whowin = flag + "win" // 연속돌 5개면 flag(black or white) + win 문자열 생성  whowin = 전역변수임
                        return
                    }
                }
                else {
                    cnt = 0
                }
            }
            //sero
            for(var j = 0 ; j < 19; j ++) {
                if (Number(arr[j][y]) == turn) {
                    cnt += 1;
                    if (cnt >= 5) {
                        whowin = flag + "win"
                    }
                }
                else {
                    cnt = 0
                }
            }

            //  \left\
            for(var i=0;i<=10;i++) {
    		var indexX = x-4+i;
			var indexY = y-4+i;
			//Number(arr[x][i]) == turn
			if(0<=indexX && indexX<=18 && 0<=indexY && indexY<=18) {
				if(Number(arr[indexX][indexY]) == turn) {
					cnt+=1;
					
					if (cnt >= 5) {
                        whowin = flag + "win"
                    }

				}else {
					cnt = 0;
				}
			}
    	}

            // /right/
            for(var i=0;i<=10;i++) {
    		var indexX = x-4+i;
			var indexY = y+4-i;
			if(0<=indexX && indexX<=18 && 0<=indexY && indexY<=18) {
				if(Number(arr[indexX][indexY]) == turn) {
					cnt+= 1;
					if (cnt >= 5) {
                        whowin = flag + "win"
                    }
				}else {
					cnt = 0;
				}
			}
    	}
        }
        
        
        
        function ajax(x,y,turn,whowin) {
        	var xhr = new XMLHttpRequest(); //XMLHttpRequest객체 생성
        	var xidx = x;
        	var yidx = y;
        	var turnsend = turn;
        	var whowinsend = whowin;
        	var url = '/boardgame/boardservlet.do?xidx=' + xidx + '&yidx=' + yidx +'&turnsend=' + turnsend + '&whowinsend=' + whowinsend;
        	xhr.open('GET', url, true); //open(방식,url,비동기(true)동기(false))
        	xhr.send();//전송임
        	xhr.onload = () => {
        		if(xhr.status == 200) {
        			console.log(xhr.response);
        			
        		} else {
        			console.log('false');
        		}
        	}
        }
        
        
        
        function doPass(x, y) { //와이거 버려
        	var xidx = x;
        	var yidx = y;
        	
        	var url = '/boardgame/boardservlet.do?xidx=' + xidx + '&yidx=' + yidx;
        	window.location.href = url; 
        }
        

        pans.forEach(e => { //클릭시 이벤트 발생
            e.onclick = (e1) => {
                // dup처리 포함
                if (turn == 1 && e1.target.firstChild.src != "") { //만약 흑turn 이면서 둘곳이 빈자리가 아닐떄 
                    document.getElementById('turndoll').src = './img/black.png';  //턴 표시해주는 돌을 흑돌 이미지 표시해주고
                    
                   /*  var nodes = [...e1.target.parentElement.children];  // 인덱스 관련 nodes변수에 이벤트 타겟 부모 요소 찾아가서 다시 자식요소들 list에 담기
                    var nodes2 = [...e1.target.parentElement.parentElement.parentElement.children]; // 상동 */
                    y = nodes.indexOf(e1.target);//위에 담은 list중에 이벤트 타겟과 같은 아이를 찾고 그 인덱스 변수에 저장
                    x = nodes2.indexOf(e1.target.parentElement.parentElement);
                    /* arr[x][y] = 1; //전역변수 arr행렬에 xy 인덱스의 값을 1로 변경   0 ->1    1이 흑 2가 백임 */
                    e1.target.firstChild.src = './img/black.png';   // 비어있는 img src에 흑돌이미지 경로 넣어주기
                    /* iswin(); // 위에 정의 했던 승리로직 발동 */
					ajax(x,y,turn,whowin); // 서블릿으로 정보 전송
					/* doPass(x, y); */
    /*                 if (whowin != "none") { // 만약 iswin() 로직이 전역변수 "none" 을 변경 시켰을 때 (누군가 승리했을떄) 이유: 흑이 뒀는때 백이 이길순 없음
                        document.getElementById('blackwin').style.display = 'block';   //승리 display속성 block
                        document.getElementById('blurblack').style.display = 'block';  //효과
                        return; */
                    }
                    turn = 2; //전역변수 turn 을 2로 변경 -> 흑턴 에서 백턴으로 
                    
                } else if(turn==2 && e1.target.firstChild.src != "") { //상
                    document.getElementById('turndoll').src = './img/white.png';
                    var nodes = [...e1.target.parentElement.children];
                    var nodes2 = [...e1.target.parentElement.parentElement.parentElement.children];
                    y = nodes.indexOf(e1.target);
                    x = nodes2.indexOf(e1.target.parentElement.parentElement);
                    arr[x][y] = 2;
                    e1.target.firstChild.src = './img/white.png';
                    iswin();
                    ajax(x,y,turn,whowin);
                    /* doPass(x, y); */
                    if (whowin != "none") {
      
                        document.getElementById('whitewin').style.display = 'block';
                        document.getElementById('blurblack').style.display = 'block';
                        return;
                    }
                    turn = 1;
                }
           
            }
        })

    </script>
    


</body>
</html>